{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ item.name }}{% endblock %}

{% block content %}
<!-- Top section: gallery + info -->
<section class="grid grid-cols-1 lg:grid-cols-5 gap-6">
  <!-- Image -->
  <div class="lg:col-span-3">
    <div class="rounded-2xl border border-slate-200 bg-white p-2">
      <div class="relative w-full h-96 sm:h-[28rem] bg-white rounded-xl">
        {% if item.image %}
          <img src="{{ item.image.url }}" alt="{{ item.name }} image"
               class="absolute inset-0 w-full h-full object-contain" />
        {% else %}
          <div class="absolute inset-0 flex items-center justify-center text-slate-400">
            No image
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Info panel -->
  <aside class="lg:col-span-2 p-6 rounded-2xl border border-slate-200 bg-white">
    <h1 class="text-3xl font-extrabold tracking-tight">{{ item.name }}</h1>

    {% if item.category %}
      <p class="mt-1 text-xs uppercase tracking-wide text-slate-500">
        Category:
        <a href="{% url 'item:items' %}?category={{ item.category.id }}"
           class="underline hover:text-slate-700">{{ item.category.name }}</a>
      </p>
    {% endif %}

    <p class="mt-3 text-lg">
      <span class="font-semibold text-slate-700">Price:</span>
      <span class="font-bold">{{ item.price|floatformat:2 }} BHD</span>
    </p>
    <p class="mt-1 text-slate-600">
      <span class="font-semibold">Seller:</span> {{ item.created_by.username }}
    </p>

    {% if item.description %}
      <div class="mt-5">
        <h2 class="text-sm font-semibold text-slate-500">Description</h2>
        <p class="mt-1 leading-relaxed text-slate-700 whitespace-pre-line">{{ item.description }}</p>
      </div>
    {% endif %}

    {% if request.user == item.created_by %}
      <div class="mt-6 flex flex-wrap gap-3">
        <a href="{% url 'item:edit' item.id %}"
           class="inline-flex items-center rounded-lg border border-slate-300 px-4 py-2 font-semibold hover:bg-slate-50">
          Edit
        </a>
        <form action="{% url 'item:delete' item.id %}" method="post"
              onsubmit="return confirm('Delete this item?');" class="inline">
          {% csrf_token %}
          <button type="submit"
                  class="inline-flex items-center rounded-lg bg-rose-600 px-4 py-2 font-semibold text-white hover:bg-rose-700">
            Delete
          </button>
        </form>
      </div>
    {% else %}
      <a href="{% url 'conversation:new' item.id %}"
         class="mt-6 inline-flex items-center rounded-lg bg-emerald-600 px-5 py-2.5 font-semibold text-white hover:bg-emerald-700">
        Contact seller
      </a>
    {% endif %}
  </aside>
</section>

<!-- Related items -->
<section class="mt-10 rounded-2xl bg-slate-100 px-6 py-10">
  <h2 class="mb-8 text-center text-2xl font-extrabold tracking-tight">Related items</h2>

  {% if related_items %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for r in related_items %}
        <a href="{% url 'item:detail' r.id %}"
           class="group rounded-2xl overflow-hidden border border-slate-200 bg-white shadow-sm hover:shadow-md transition-shadow">
          <div class="relative w-full h-56 bg-white">
            {% if r.image %}
              <img src="{{ r.image.url }}" alt="{{ r.name }} image"
                   class="absolute inset-0 w-full h-full object-contain p-2" loading="lazy" />
            {% else %}
              <div class="absolute inset-0 flex items-center justify-center text-slate-400">No image</div>
            {% endif %}
          </div>
          <div class="p-5">
            <h3 class="text-lg font-bold leading-snug group-hover:underline">{{ r.name }}</h3>
            <p class="mt-1 text-sm text-slate-700">Price: {{ r.price|floatformat:2 }} BHD</p>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center text-slate-600">No related items found.</p>
  {% endif %}
</section>
{% endblock %}
