{% extends 'core/base.html' %}
{% load static %}

{% block title %}Items{% endblock %}

{% block content %}
<section class="rounded-2xl bg-slate-100 p-6">
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Sidebar -->
    <aside class="lg:col-span-1">
      <form method="get" action="{% url 'item:items' %}" class="rounded-xl border border-slate-200 bg-white p-4">
        <label for="query" class="block text-sm font-semibold text-slate-700 mb-1">Search</label>
        <input id="query" name="query"
               class="w-full rounded-lg border border-slate-300 px-4 py-2 outline-none focus:ring-2 focus:ring-slate-900"
               type="text" value="{{ query }}" placeholder="atomic habits..." />
        {% if category_id %}
          <input type="hidden" name="category" value="{{ category_id }}">
        {% endif %}
        <button class="mt-3 w-full rounded-lg bg-emerald-600 px-4 py-2 font-semibold text-white hover:bg-emerald-700">
          Search
        </button>
      </form>

      <hr class="my-6">

      <p class="font-semibold text-slate-800">Categories</p>
      {% with selected=category_id %}
      <ul class="mt-2 space-y-1">
        <li>
          <a href="{% url 'item:items' %}?query={{ query|urlencode }}"
             class="block rounded-lg px-3 py-2 {% if not selected %}bg-emerald-50 text-emerald-700 font-semibold{% else %}hover:bg-slate-100{% endif %}">
            All categories
          </a>
        </li>
        {% for category in categories %}
          <li>
            <a href="{% url 'item:items' %}?query={{ query|urlencode }}&category={{ category.id }}"
               class="flex items-center justify-between rounded-lg px-3 py-2
                      {% if category.id == selected %}bg-emerald-50 text-emerald-700 font-semibold{% else %}hover:bg-slate-100{% endif %}">
              <span>{{ category.name }}</span>
              <span class="text-xs text-slate-500">({{ category.items.count }})</span>
            </a>
          </li>
        {% endfor %}
      </ul>
      {% endwith %}

      <hr class="my-6">

      <a href="{% url 'item:items' %}"
         class="inline-flex w-full items-center justify-center rounded-lg bg-yellow-500 px-4 py-2 font-semibold text-white hover:bg-yellow-600">
        Clear filters
      </a>
    </aside>

    <!-- Results -->
    <div class="lg:col-span-3">
      {% if items %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for item in items %}
            <a href="{% url 'item:detail' item.id %}"
               class="group rounded-2xl overflow-hidden border border-slate-200 bg-white shadow-sm hover:shadow-md transition-shadow">
              <div class="relative w-full h-56 bg-white">
                {% if item.image %}
                  <img src="{{ item.image.url }}" alt="{{ item.name }} image"
                       class="absolute inset-0 h-full w-full object-contain p-2" loading="lazy" />
                {% else %}
                  <img src="{% static 'img/placeholder.png' %}" alt="No image"
                       class="absolute inset-0 h-full w-full object-contain p-2" loading="lazy" />
                {% endif %}
              </div>

              <div class="p-5">
                <h2 class="text-lg font-bold leading-snug group-hover:underline">{{ item.name }}</h2>
                <p class="mt-1 text-sm text-slate-700">Price: {{ item.price|floatformat:2 }} BHD</p>
              </div>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="rounded-xl border border-dashed border-slate-300 bg-white p-10 text-center">
          <p class="text-slate-600">No items match your filters.</p>
          <a href="{% url 'item:items' %}"
             class="mt-4 inline-flex items-center rounded-lg bg-emerald-600 px-4 py-2 font-semibold text-white hover:bg-emerald-700">
            Reset filters
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
